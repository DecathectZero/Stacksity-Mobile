<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=medium-dpi, user-scalable=no" />
    <link rel="stylesheet" href="css/jquerymobile.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <!--<link rel="stylesheet" href="css/bootstraptheme.css">-->
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script type="text/javascript" src="cordova.js"></script>
    <script>
        document.addEventListener("deviceready", onDeviceReady, false);
        // device APIs are available
        //
        function onDeviceReady() {
            //Adds in notification
            if(PushbotsPlugin.isiOS()){
                PushbotsPlugin.initializeiOS("561ed24517795902148b4569");
            }
            if(PushbotsPlugin.isAndroid()){
                PushbotsPlugin.initializeAndroid("561ed24517795902148b4569", "907553791348");
            }
            PushbotsPlugin.setAlias(localStorage.getItem('username'));
            navigator.splashscreen.hide();
//            StatusBar.hide();
            StatusBar.overlaysWebView(false);
            StatusBar.backgroundColorByHexString("#ffffff");
            StatusBar.styleDefault();
            //alert(localStorage.getItem('ustack')+" "+localStorage.getItem('username'));
            if (localStorage.getItem("session_id") === null) {
                document.location.href = 'login.html';
            }
        }
    </script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquerymobile.js"></script>
    <script src="js/main.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/autogrow.js"></script>
    <script src="js/output.js"></script>
    <script src="js/vote.js"></script>
    <script type="text/javascript">
        $(document).one("mobileinit", function () {
            $.mobile.pageContainer = $('#container');
            $.mobile.defaultPageTransition = 'slide';
            $.mobile.defaultPageTransition = 'slide';
        });
        var _gaq = _gaq || [];

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

        var loader =
                '<div class="spinner">'+
                    '<div class="double-bounce1"></div>'+
                    '<div class="double-bounce2"></div>'+
                '</div>';

        $(document).on('pagebeforeshow',function(event,ui){
            var activepage = $.mobile.activePage;
            if(changepage){
                changepage = false;
                if(option==3){
                    openNote();
                }
            }else{
                explore = false;
                postbox=false;
                var acrid = activepage.attr("id");
                if(acrid=="toppage"){
                    option = 1;
                }else if(acrid=="searchpage"){
                    option = 2;
                }else if(acrid=="notepage"){
                    option = 3;
                }else if(acrid=="allpage"){
                    option = 4;
                }else if(acrid=="userpage"){
                    option = 5;
                }else if(acrid=="post"){
                    option = 7;
                }else if(acrid=="explorepage"){
                    explore = true;
                    option = 6;
                }else if(acrid=="postpage"){
                    postbox=true;
                }
                init();
            }
            if(option == 7){
                $('#postcon').empty();
                $('#postcon').hide();
                $('#commentfeed').html(loader);
                getPost(postid);
            }
            if(postbox){
                initPostBox();
                if(postype==1){
                    linkpost();
                }else if(postype==2){
                    textpost();
                }else if(postype==3){
                    imagepostShow();
                }
            }else{
                try {
                    _gaq.push(['_setAccount', 'UA-46439393-3']);

                    hash = location.hash;

                    if (hash) {
                        _gaq.push(['_trackPageview', hash.substr(1)]);
                    } else {
                        _gaq.push(['_trackPageview']);
                    }
                } catch(err) {

                }
            }
        });
        $(document).on('pagechange',function(event,ui){
            var activepage = $.mobile.activePage;
//            ui.prevPage.find(".extracontainer").css("-webkit-overflow-scrolling","auto");
            console.log(explore);
            console.log(option);
            if(!postbox){
                if(isStackOption()){
                    loading = false;
                    end = false;
                    bottom = false;
                    if(!postbox){
                        if(activepage.data("stack_id")==null&&!postbox){
                            activepage.find('.scroll').html('<p>Loading Stack...</p>');
                            var activestack = stackid;
                            if(explore){
                                //activepage.find(".locbar").remove();
                                if(activestack<0){
                                    var explorename;
                                    if(activestack=="-1"){
                                        explorename = "Everything"
                                    }else if(activestack=="-3"){
                                        explorename = "Recent"
                                    }
//                                    $("#explorehead").hide();
//                                    $("#exgap").hide();
                                    $("#explorehead").html('<div class="headercaption">'+explorename+'</div>')
                                }else{
                                    $("#explorehead").html('<div class="row posting center">'+
                                    '<a class="col-xs-4 postlink" onclick="postOpen(1)">Link</a>'+
                                    '<a class="col-xs-4 postlink" onclick="postOpen(2)">Text</a>'+
                                    '<a class="col-xs-4 postlink" onclick="postOpen(3)">Image</a>'+
                                    '</div>');
//                                    $("#exgap").show();
                                }
                                //activepage.find('.scroll').html('<p>Loading Posts</p> ');
                            }
                            bannerset(activepage, stackid);
                            var contain = activepage.find(".extracontainer");
                            contain.bind("scrollstop", function() {
                                if(!postbox){
                                    if(contain.scrollTop() + $(window).height() > activepage.find(".con").height() - 200) {
                                        if(!end&&!bottom&&!loading){
                                            bottom = true;
                                            activepage.find('.scroll').html('<p>Loading Posts</p> ');
                                            //alert(activepage.data("distance"));
                                            if(activepage.data("distance")==0||activepage.data("distance")==undefined){
                                                startNews(startnews, activepage, stackid);
                                            }else{
                                                startNews(startnews, activepage, stackid, activepage.data("distance"));
                                            }
                                        }
                                    }
                                }
                            });
                        }else{
                            stackid = activepage.data("stack_id");
                            is_user = activepage.data("is_user");
                            stackname = activepage.data("stackname");
                            startnews = activepage.data("startnews");
                        }
                    }
                }
            }
        });
        $(document).on('pageshow',function(event,ui){
            if(explore){
                if(dontdelete){
                    dontdelete = false;
                    ui.prevPage.remove();
                }
            }
            if(!postbox){
//                var activepage = $.mobile.activePage;
//                activepage.find(".extracontainer").css("-webkit-overflow-scrolling","touch");
                if(isStackOption()){
                    if(postdata!=null){
                        $.mobile.activePage.find(".extracontainer").scrollTop(0);
                        parsePostData();
                    }
                }
            }
        });
    </script>
<body>
<div class="footer">
    <div class="center botmenu">
        <div class="quarter" id="topstack" data-op="1">
            <div class="glyphicon glyphicon-home"></div>
        </div>
        <div class="quarter" id="searchstack" data-op="2">
            <div class="glyphicon glyphicon-search"></div>
        </div>
        <div class="quarter" id="notestack" data-op="3">
            <div class="glyphicon glyphicon-bell"></div>
        </div>
        <div class="quarter" id="allstack" data-op="4">
            <div class="glyphicon glyphicon-globe"></div>
        </div>
        <div class="quarter" id="userstack" data-op="5">
            <div class="glyphicon glyphicon-user"></div>
        </div>
    </div>
</div>
<div class="modal fade" id="delpost" style="display: none;" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <p>Are you sure you want to delete this post?</p>
            </div>
            <div class="modal-footer">
                <a data-role="none" id="deletelink" onclick="del()" class="btn btn-primary ">Delete</a>
                <button data-role="none" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="commentdelete" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <p>Are you sure you want to delete this comment?</p>
            </div>
            <div class="modal-footer">
                <a id="deletecomment" onclick="delcom()" class="btn btn-primary">Delete</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="repost" style="display: none">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <p>Are you sure you want to report this post? Only report posts that have not been properly labeled NSFW or are blatantly illegal, an abuse of the report function will have automatic severe consequences</p>
            </div>
            <div class="modal-footer">
                <a id="reportlink" onclick="report()" class="btn btn-primary">Report</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div id="container">
<div data-role="page" data-dom-cache="true" id="explorepage" class="ex">
    <div data-role="header" data-id="persistent" data-position="fixed"  class="head padding-top" data-fullscreen="true" data-tap-toggle="false" id="explorehead">
        <div class="headercaption">&nbsp;</div>
    </div>
    <div class="extracontainer">
        <div class="con">
            <div class="topgap" id="exgap"></div>
            <div class="banner center" style="display: none">
                <div class="center banner-inner">
                    <div class="bannertext">
                    </div>
                </div>
            </div>
            <div class="center feed">
            </div>
            <div class="scroll center">
                <p>Loading Stack</p>
            </div>
            <div class="botgap"></div>
        </div>
    </div>
</div>
<div data-role="page" data-dom-cache="true" id="toppage">
    <div data-role="header" data-id="persistent" data-position="fixed" class="head padding-top" data-fullscreen="true" data-tap-toggle="false">
        <div class="headercaption">Stacksity</div>
    </div>
    <div class="extracontainer">
        <div class="con">
            <div class="topgap"></div>
            <div class="banner center" style="display: none">
                <div class="center banner-inner">
                    <div class="bannertext">
                    </div>
                </div>
            </div>
            <div class="center feed">
            </div>
            <div class="scroll center">
                <p>Loading Stack</p>
            </div>
            <div class="botgap"></div>
        </div>
    </div>
</div>

<div data-role="page" data-dom-cache="true" id="allpage">
    <div data-role="header" data-id="persistent" data-position="fixed" class="head padding-top" data-fullscreen="true" data-tap-toggle="false">
        <div class="headercaption">near</div>
    </div>
    <div class="extracontainer">
        <div class="con">
            <div class="topgap"></div>
            <div class="banner center" style="display: none">
                <div class="center banner-inner">
                    <div class="bannertext">
                    </div>
                </div>
            </div>
            <div class="center locbar" style="padding: 0px 0 6px 0">
                <div class="btn-group btn-group-justified" role="group" aria-label="...">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default dist-btn" onclick="setDist(0.1, this)">Close</button>
                    </div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default dist-btn" onclick="setDist(5, this)" disabled="">Near</button>
                    </div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-default dist-btn" onclick="setDist(50, this)">Far</button>
                    </div>
                </div>
            </div>
            <div class="center feed">
            </div>
            <div class="scroll center">
                <p>Loading Stack</p>
            </div>
            <div class="botgap"></div>
        </div>
    </div>
</div>

<div data-role="page" data-dom-cache="true" id="notepage">
    <div data-role="header" data-id="persistent" data-position="fixed" class="head padding-top" data-fullscreen="true" data-tap-toggle="false">
        <div class="headercaption">Notifications</div>
    </div>
    <div class="extracontainer">
        <div class="con" style="min-height: 101%">
            <div class="topgap"></div>
            <div class="center note-header">
            </div>
            <div class="notescroll center">
                <p>Loading Notifications</p>
            </div>
            <div class="botgap"></div>
        </div>
    </div>
</div>

<div data-role="page" data-dom-cache="true" id="userpage">
    <div data-role="header" data-id="persistent" data-position="fixed" class="head padding-top" data-fullscreen="true" data-tap-toggle="false">
        <div class="row posting center">
            <a class="col-xs-4 postlink" onclick="postOpen(1)">Link</a>
            <a class="col-xs-4 postlink" onclick="postOpen(2)">Text</a>
            <a class="col-xs-4 postlink" onclick="postOpen(3)">Image</a>
        </div>
    </div>
    <div class="extracontainer">
        <div class="con">
            <div class="topgap"></div>
            <div class="banner center" style="display: none">
                <div class="center banner-inner">
                    <div class="bannertext">
                    </div>
                </div>
            </div>
            <div class="center feed">
            </div>
            <div class="scroll center">
                <p>Loading Stack</p>
            </div>
            <div class="botgap"></div>
        </div>
    </div>
</div>

<div data-role="page" data-dom-cache="false" id="postpage">
    <div data-role="header" data-id="persistent" data-position="fixed" class="head padding-top" data-fullscreen="true" data-tap-toggle="false">
        <div class="row postrow posting center">
            <div class="col-xs-4 postlink" onclick="linkpost()" id="postlink">Link</div>
            <div class="col-xs-4 postlink" onclick="textpost()" id="posttext">Text</div>
            <div class="col-xs-4 postlink" onclick="imagepostShow()" id="postimage">Image</div>
        </div>
    </div>
    <div class="center post">
        <div class="topgap"></div>
        <label class="postlabel">
            <div class="postbar" style="padding: 0">
                <a class="cancelpost" data-rel="back" data-role="button" data-corners="false" data-inline="true" onclick="postbox = false" id="cancelpost">cancel</a>
                <p>posting to <span class="bold" id="posting"></span></p>
            </div>
        </label>
        <form class="postform toppost" id="toppost">
            <input type="hidden" id="posttype" name="type" value="0">
            <div class="postcon">
                <p>title <span id="title-count">100</span></p>
                <input name="title" type="text" id="title-input" class="texts" placeholder="post title" maxlength="100" required="" data-role="none">
                <div id="linkpost" style="display: none;">
                    <p>link <span id="link-alert"></span></p>
                    <input name="link" type="url" id="link" class="texts" placeholder="submit a link here" maxlength="500" required="" data-role="none">
                </div>
                <div id="textpost" style="display: none;">
                    <p>text</p>
                    <textarea name="text" class="expanding" id="text" placeholder="write something here..." rows="2" maxlength="6500" data-role="none"></textarea>
                </div>
                <div id="imagepost">
                    <p>image</p>
                    <div class="input-group">
                        <span class="input-group-btn">
                            <span class="btn btn-primary btn-file" id="uploadimage">
                             <span class="glyphicon glyphicon-camera" ></span> Photo
                            <input type="file" accept="image/x-png, image/gif, image/jpeg" onchange="upload(this.files[0])" data-role="none">
                            </span>
                        </span>
                        <input type="text" id="imageid" class="form-control" readonly="" data-role="none">
                    </div>
                    <div class="background-image"><img src="" id="imagePostPreview" class="img-responsive"></div>
                </div>
            </div>
            <div class="postsub">
                <input type="hidden" name="setprivate" value="0" id="privatefield">
                <button type="submit" id="pbutton" class="postb" data-role="none">Post</button>
                <button type="button" id="private" class="postb private" data-role="none">Private</button>
            </div>
        </form>
        <div class="botgap"></div>
    </div>
    <script>$( "#title-input" ).keyup(function() {
        var length = $( this ).val().length;
        $( "#title-count").html(100-length);
    });</script>
</div>

<div data-role="page" data-dom-cache="true" id="searchpage">
    <div class="extracontainer">
        <div class="center stacks">
            <div class="padding-top">
                <div id="stacksearch" class="stacklist">
                    <h1>Search for Stacks</h1>
                    <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search for stacks.." data-filter-theme="d"></ul>
                </div>
            </div>
            <div class="stacklist">
                <div class="stackl listlink" id="es">
                    <a href="#" class="stacklink" data-link="-1">$everything</a>
                    <a href="#" class="stacklink" data-link="-3">$recent</a>
                </div>
            </div>
            <div class="btn-group btn-group-justified" role="group" aria-label="...">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default postlink" onclick="stack()">Stacks</button>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default postlink" onclick="use()">Users</button>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default postlink" onclick="ex()">Explore</button>
                </div>
            </div>
            <div class="fstack" style="display: none">
                <div class="stacklist">
                    <h5>Followed Stacks</h5>
                    <div class="stackls stackl" id="fs"></div>
                </div>
            </div>
            <div class="fusers" style="display: none">
                <div class="stacklist">
                    <h5>Followed Users</h5>
                    <div class="stackls stackl" id="fu"></div>
                </div>
            </div>
            <div class="rstack" style="display: none">
                <div class="stacklist">
                    <h5>Default Stacks</h5>
                    <div class="stackl listlink">
                        <a href="/$art">$art</a>
                        <a href="/$cute">$cute</a>
                        <a href="/$discuss">$discuss</a>
                        <a href="/$fitness">$fitness</a>
                        <a href="/$food">$food</a>
                        <a href="/$foundout">$foundout</a>
                        <a href="/$gaming">$gaming</a>
                        <a href="/$interesting">$interesting</a>
                        <a href="/$lol">$lol</a>
                        <a href="/$movies">$movies</a>
                        <a href="/$music">$music</a>
                        <a href="/$news">$news</a>
                        <a href="/$photography">$photography</a>
                        <a href="/$questions">$questions</a>
                        <a href="/$science">$science</a>
                        <a href="/$writing">$writing</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>Cities</h5>
                    <div class="stackl listlink">
                        <a href="/$vancouver">$vancouver</a>
                        <a href="/$toronto">$toronto</a>
                        <a href="/$seattle">$seattle</a>
                        <a href="/$montreal">$montreal</a>
                        <a href="/$winnipeg">$winnipeg</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>University Stacks</h5>
                    <div class="stackl listlink">
                        <a href="/$university">$university</a>
                        <a href="/$ubc">UBC ($ubc)</a>
                        <a href="/$uchicago">UChicago ($uchicago)</a>
                        <a href="/$uoft">UofT ($uoft)</a>
                        <a href="/$uoft">UCLA ($ucla)</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>Music</h5>
                    <div class="stackl listlink" >
                        <a href="/$music">$music</a>
                        <a href="/$musicproduction">$musicproduction</a>
                        <a href="/$electronicmusic">$electronicmusic</a>
                        <a href="/$hiphop">$hiphop</a>
                        <a href="/$metal">$metal</a>
                        <a href="/$listentothis">$listentothis</a>
                        <a href="/$jazz">$jazz</a>
                        <a href="/$beats">$beats</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>Tech</h5>
                    <div class="stackl listlink" >
                        <a href="/$technews">$technews</a>
                        <a href="/$techtoys">$techtoys</a>
                        <a href="/$programming">$programming</a>
                        <a href="/$buildapc">$buildapc</a>
                        <a href="/$apple">$apple</a>
                        <a href="/$android">$android</a>
                        <a href="/$microsoft">$microsoft</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>Visual</h5>
                    <div class="stackl listlink" >
                        <a href="/$art">$art</a>
                        <a href="/$design">$design</a>
                        <a href="/$comics">$comics</a>
                        <a href="/$critiquemyart">$critiquemyart</a>
                        <a href="/$graffiti">$graffiti</a>
                        <a href="/$typography">$typography</a>
                    </div>
                </div>
                <div class="stacklist">
                    <h5>Games</h5>
                    <div class="stackl listlink">
                        <a href="/$gaming">$gaming</a>
                        <a href="/$ssb">$ssb</a>
                        <a href="/$rpg">$rpg</a>
                        <a href="/$leagueoflegends">$leagueoflegends</a>
                        <a href="/$hearthstone">$hearthstone</a>
                        <a href="/$counterstrike">$counterstrike</a>
                        <a href="/$gamesonsale">$gamesonsale</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="botgap"></div>
    </div>
</div>
<div data-role="page" id="post">
    <div data-role="header" class="head posthead padding-top">
        <a data-role="none" data-rel="back" class="postlink postback"><div class="glyphicon glyphicon-chevron-left"></div></a>
    </div>
    <div class="extracontainer">
        <div class="topgap"></div>
        <div id="postcon" class="center" >
        </div>
        <div id="comments" class="center">
            <form id="commentform">
                <div class="postcon">
                    <textarea name="text" id="commenttext" placeholder="write something here..." rows="2" data-role="none"></textarea>
                </div>
                <div class="postsub" style="margin-bottom: 0">
                    <button type="submit" id="cbutton" data-corners="false">comment</button>
                </div>
            </form>
            <div id="commentfeed">
            </div>
        </div>
        <div class="botgap"></div>
    </div>
</div>
</div>
<script>
    init();
    $("#commenttext").expanding();
    $( "#autocomplete" ).on( "listviewbeforefilter", function ( e, data ) {
        var $ul = $( this ),
                $input = $( data.input ),
                value = $input.val(),
                html = "";
        $ul.html( "" );
        if ( value && value.length > 0) {
            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
            $ul.listview( "refresh" );
//        alert($input.val());
            $.ajax({
                url: "https://stacksity.com/php/search.php",
                dataType: "json",
                type: "GET",
                crossDomain: true,
                data: {
                    term: value
                }
            }).then( function ( response ) {
//            alert(JSON.stringify(response));
                if(value.charAt(0)=="$"&&value.length>1){
                    html += "<li onclick='linkToStack(\""+value+"\")'>" + value + "</li>";
                    $.each( response, function ( i, val ) {
                        if(val.value!=value) html += "<li onclick='linkToStack("+val.id+")'>" + val.value + "</li>";
                    });
                }else{
                    if(response.length==0){
                        html += "<li><span style='color:#f00'>" + value + "</span> doesn't exist" + "</li>";
                    }else{
                        $.each( response, function ( i, val ) {
                            html += "<li onclick='linkToStack("+val.id+")'>" + val.value + "</li>";
                        });
                    }
                }
                $ul.html( html );
                $ul.listview( "refresh" );
                $ul.trigger( "updatelayout");
            });
        }
    });
    $(".quarter").on('tap', function (e) {
        e.preventDefault();
        refreshPage($(this).data("op"));
    });
    ex();
    set();
</script>
</body>
</html>
